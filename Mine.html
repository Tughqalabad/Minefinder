<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Minesweeper</title>
  <style>
    body { background:#c0c0c0; font-family:sans-serif; margin:0; display:flex; justify-content:center; }
    #game { margin-top:20px; text-align:center; }
    .topbar {
      display:flex; justify-content:center; align-items:center;
      background:#808080; border:4px solid #7b7b7b; padding:6px; margin-bottom:8px;
    }
    #restart {
      font-size:22px; width:40px; height:40px;
      border:2px solid #7b7b7b; background:#c0c0c0;
      cursor:pointer; border-radius:4px;
    }
    #restart:hover { background:#dcdcdc; }
    .board { display:grid; border:4px solid #808080; background:#808080; margin:0 auto; }
    .cell {
      width:28px; height:28px; border:2px solid; border-color:#fff #7b7b7b #7b7b7b #fff;
      background:#c0c0c0; font-size:18px; font-weight:bold;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; user-select:none;
    }
    .cell.revealed {
      border:1px solid #7b7b7b;
      background:#dcdcdc;
      cursor:default;
    }
    .cell.mine { background:#ff4d4d; }
    .cell.flag { background:#c0c0c0; color:red; }
    .cell.number-1 { color:blue; }
    .cell.number-2 { color:green; }
    .cell.number-3 { color:red; }
    .cell.number-4 { color:navy; }
    .cell.number-5 { color:brown; }
    .cell.number-6 { color:teal; }
    .cell.number-7 { color:black; }
    .cell.number-8 { color:gray; }
  </style>
</head>
<body>
<div id="game">
  <div class="topbar">
    <button id="restart">ðŸ˜Š</button>
  </div>
  <div id="board" class="board"></div>
</div>

<script>
const boardEl = document.getElementById('board');
const restartBtn = document.getElementById('restart');
let ROWS = 16, COLS = 16, MINES = 40;
let grid = [];
let started = false, gameOver = false;

function init(){
  boardEl.style.gridTemplateColumns = `repeat(${COLS}, auto)`;
  grid = []; boardEl.innerHTML = ''; gameOver = false; started = false;
  restartBtn.textContent = "ðŸ˜Š";

  for(let r=0;r<ROWS;r++){
    grid[r] = [];
    for(let c=0;c<COLS;c++){
      const cell = {r,c,mine:false,count:0,revealed:false,flag:false,el:null};
      const el = document.createElement('div');
      el.className = 'cell';
      el.addEventListener('click', ()=>leftClick(cell));
      el.addEventListener('contextmenu', e=>{e.preventDefault();rightClick(cell);});
      el.addEventListener('mousedown', e=>{
        if(e.button===1) { e.preventDefault(); middleClick(cell); }
      });
      cell.el = el;
      grid[r][c] = cell;
      boardEl.appendChild(el);
    }
  }
}

function placeMines(excludeR,excludeC){
  let placed = 0;
  while(placed<MINES){
    const r=Math.floor(Math.random()*ROWS), c=Math.floor(Math.random()*COLS);
    if(grid[r][c].mine || (Math.abs(r-excludeR)<=1 && Math.abs(c-excludeC)<=1)) continue;
    grid[r][c].mine = true; placed++;
  }
  for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){
    let count=0;
    for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
      const nr=r+dr,nc=c+dc;
      if(nr<0||nc<0||nr>=ROWS||nc>=COLS) continue;
      if(grid[nr][nc].mine) count++;
    }
    grid[r][c].count = count;
  }
}

function reveal(cell){
  if(cell.revealed||cell.flag||gameOver) return;
  cell.revealed=true;
  cell.el.classList.add('revealed');
  if(cell.mine){
    cell.el.textContent="ðŸ’£";
    cell.el.classList.add('mine');
    restartBtn.textContent = "ðŸ˜µ";
    endGame(false);
  } else if(cell.count>0){
    cell.el.textContent=cell.count;
    cell.el.classList.add(`number-${cell.count}`);
  } else {
    for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
      const nr=cell.r+dr,nc=cell.c+dc;
      if(nr<0||nc<0||nr>=ROWS||nc>=COLS) continue;
      reveal(grid[nr][nc]);
    }
  }
}

function leftClick(cell){
  if(!started){ placeMines(cell.r,cell.c); started=true; }
  reveal(cell);
}

function rightClick(cell){
  if(cell.revealed||gameOver) return;
  cell.flag=!cell.flag;
  cell.el.textContent = cell.flag ? "ðŸš©" : "";
  cell.el.classList.toggle("flag",cell.flag);
}

function middleClick(cell){
  if(!cell.revealed||cell.count===0) return;
  let flags=0;
  for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
    const nr=cell.r+dr,nc=cell.c+dc;
    if(nr<0||nc<0||nr>=ROWS||nc>=COLS) continue;
    if(grid[nr][nc].flag) flags++;
  }
  if(flags===cell.count){
    for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
      const nr=cell.r+dr,nc=cell.c+dc;
      if(nr<0||nc<0||nr>=ROWS||nc>=COLS) continue;
      const neighbor=grid[nr][nc];
      if(!neighbor.flag && !neighbor.revealed) reveal(neighbor);
    }
  }
}

function endGame(win){
  gameOver=true;
  if(win) restartBtn.textContent = "ðŸ˜Ž";
  for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){
    const cell=grid[r][c];
    if(cell.mine && !cell.revealed){
      cell.el.textContent="ðŸ’£";
      cell.el.classList.add('revealed','mine');
    }
  }
}

restartBtn.addEventListener('click', ()=>init());
init();
</script>
</body>
</html>
